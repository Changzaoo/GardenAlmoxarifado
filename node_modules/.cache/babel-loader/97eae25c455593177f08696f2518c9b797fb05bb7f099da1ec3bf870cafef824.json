{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { historicoInicial } from '../../data/historicoInicial';\nimport { ref, set, onValue } from 'firebase/database';\nimport { db } from '../firebaseConfig';\nimport { encryptData, decryptData } from '../services/encryptionService';\nexport const useEmprestimos = () => {\n  _s();\n  const [emprestimos, setEmprestimos] = useState([]);\n\n  // Carregar dados ao inicializar\n  useEffect(() => {\n    const emprestimosRef = ref(db, 'emprestimos');\n    onValue(emprestimosRef, snapshot => {\n      const data = snapshot.val();\n      if (data) {\n        setEmprestimos(decryptData(data));\n      } else {\n        setEmprestimos(historicoInicial);\n      }\n    });\n  }, []);\n  const adicionarEmprestimo = (novoEmprestimo, atualizarInventario) => {\n    if (!novoEmprestimo.colaborador || novoEmprestimo.ferramentas.length === 0) return;\n    const lista = Array.isArray(emprestimos) ? emprestimos : [];\n    const novoId = Math.max(...lista.map(e => e.id), 0) + 1;\n    const emprestimo = {\n      id: novoId,\n      colaborador: novoEmprestimo.colaborador,\n      ferramentas: [...novoEmprestimo.ferramentas],\n      dataRetirada: novoEmprestimo.dataRetirada,\n      horaRetirada: novoEmprestimo.horaRetirada,\n      dataDevolucao: null,\n      horaDevolucao: null,\n      status: 'emprestado',\n      responsavel: 'vinicius'\n    };\n    setEmprestimos(prev => [...prev, emprestimo]);\n\n    // Atualizar disponibilidade no invent치rio\n    atualizarInventario(novoEmprestimo.ferramentas, 'remover');\n    return emprestimo;\n  };\n  const devolverFerramentas = (id, atualizarInventario) => {\n    const emprestimo = emprestimos.find(e => e.id === id);\n    if (!emprestimo) return;\n    const agora = new Date();\n    setEmprestimos(prev => prev.map(emp => emp.id === id ? {\n      ...emp,\n      dataDevolucao: agora.toISOString().split('T')[0],\n      horaDevolucao: agora.toTimeString().slice(0, 5),\n      status: 'devolvido'\n    } : emp));\n\n    // Atualizar disponibilidade no invent치rio\n    atualizarInventario(emprestimo.ferramentas, 'adicionar');\n  };\n  const removerEmprestimo = (id, atualizarInventario) => {\n    const emprestimo = emprestimos.find(e => e.id === id);\n    if (!emprestimo) return;\n\n    // Se estava emprestado, devolver para o estoque\n    if (emprestimo.status === 'emprestado') {\n      atualizarInventario(emprestimo.ferramentas, 'adicionar');\n    }\n    setEmprestimos(prev => prev.filter(emp => emp.id !== id));\n  };\n  return {\n    emprestimos,\n    adicionarEmprestimo,\n    devolverFerramentas,\n    removerEmprestimo,\n    setEmprestimos\n  };\n};\n_s(useEmprestimos, \"94/6FWUAORTl5kEEVVhrqk6ZElk=\");","map":{"version":3,"names":["useState","historicoInicial","ref","set","onValue","db","encryptData","decryptData","useEmprestimos","_s","emprestimos","setEmprestimos","useEffect","emprestimosRef","snapshot","data","val","adicionarEmprestimo","novoEmprestimo","atualizarInventario","colaborador","ferramentas","length","lista","Array","isArray","novoId","Math","max","map","e","id","emprestimo","dataRetirada","horaRetirada","dataDevolucao","horaDevolucao","status","responsavel","prev","devolverFerramentas","find","agora","Date","emp","toISOString","split","toTimeString","slice","removerEmprestimo","filter"],"sources":["C:/Users/vinic/OneDrive/Documentos/Almo/src/components/hooks/useEmprestimos.js"],"sourcesContent":["import { useState } from 'react';\r\nimport { historicoInicial } from '../../data/historicoInicial';\r\nimport { ref, set, onValue } from 'firebase/database';\r\nimport { db } from '../firebaseConfig';\r\nimport { encryptData, decryptData } from '../services/encryptionService'; \r\n\r\nexport const useEmprestimos = () => {\r\n  const [emprestimos, setEmprestimos] = useState([]);\r\n  \r\n  // Carregar dados ao inicializar\r\n  useEffect(() => {\r\n    const emprestimosRef = ref(db, 'emprestimos');\r\n    onValue(emprestimosRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        setEmprestimos(decryptData(data));\r\n      } else {\r\n        setEmprestimos(historicoInicial);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const adicionarEmprestimo = (novoEmprestimo, atualizarInventario) => {\r\n  if (!novoEmprestimo.colaborador || novoEmprestimo.ferramentas.length === 0) return;\r\n\r\n  const lista = Array.isArray(emprestimos) ? emprestimos : [];\r\n  const novoId = Math.max(...lista.map(e => e.id), 0) + 1;\r\n    const emprestimo = {\r\n      id: novoId,\r\n      colaborador: novoEmprestimo.colaborador,\r\n      ferramentas: [...novoEmprestimo.ferramentas],\r\n      dataRetirada: novoEmprestimo.dataRetirada,\r\n      horaRetirada: novoEmprestimo.horaRetirada,\r\n      dataDevolucao: null,\r\n      horaDevolucao: null,\r\n      status: 'emprestado',\r\n      responsavel: 'vinicius'\r\n    };\r\n\r\n    setEmprestimos(prev => [...prev, emprestimo]);\r\n    \r\n    // Atualizar disponibilidade no invent치rio\r\n    atualizarInventario(novoEmprestimo.ferramentas, 'remover');\r\n    \r\n    return emprestimo;\r\n  };\r\n\r\n  const devolverFerramentas = (id, atualizarInventario) => {\r\n    const emprestimo = emprestimos.find(e => e.id === id);\r\n    if (!emprestimo) return;\r\n    \r\n    const agora = new Date();\r\n    \r\n    setEmprestimos(prev => prev.map(emp => \r\n      emp.id === id \r\n        ? { \r\n            ...emp, \r\n            dataDevolucao: agora.toISOString().split('T')[0], \r\n            horaDevolucao: agora.toTimeString().slice(0, 5),\r\n            status: 'devolvido' \r\n          }\r\n        : emp\r\n    ));\r\n\r\n    // Atualizar disponibilidade no invent치rio\r\n    atualizarInventario(emprestimo.ferramentas, 'adicionar');\r\n  };\r\n\r\n  const removerEmprestimo = (id, atualizarInventario) => {\r\n    const emprestimo = emprestimos.find(e => e.id === id);\r\n    if (!emprestimo) return;\r\n    \r\n    // Se estava emprestado, devolver para o estoque\r\n    if (emprestimo.status === 'emprestado') {\r\n      atualizarInventario(emprestimo.ferramentas, 'adicionar');\r\n    }\r\n    \r\n    setEmprestimos(prev => prev.filter(emp => emp.id !== id));\r\n  };\r\n\r\n  return {\r\n    emprestimos,\r\n    adicionarEmprestimo,\r\n    devolverFerramentas,\r\n    removerEmprestimo,\r\n    setEmprestimos\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}