{"ast":null,"code":"import _objectSpread from\"C:/Users/vinic/OneDrive/Documentos/Almo/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect}from'react';import{historicoInicial}from'../../data/historicoInicial';import{ref,set,onValue}from'firebase/database';import{db}from'../../firebaseConfig';import{encryptData,decryptData}from'../../services/encryptionService';export const useEmprestimos=()=>{const[emprestimos,setEmprestimos]=useState([]);// Carregar dados ao inicializar\nuseEffect(()=>{const emprestimosRef=ref(db,'emprestimos');onValue(emprestimosRef,snapshot=>{const data=snapshot.val();if(data){setEmprestimos(decryptData(data));}else{setEmprestimos(historicoInicial);}});},[]);const adicionarEmprestimo=(novoEmprestimo,atualizarInventario)=>{if(!novoEmprestimo.colaborador||novoEmprestimo.ferramentas.length===0)return;const lista=Array.isArray(emprestimos)?emprestimos:[];const novoId=Math.max(...lista.map(e=>e.id),0)+1;const emprestimo={id:novoId,colaborador:novoEmprestimo.colaborador,ferramentas:[...novoEmprestimo.ferramentas],dataRetirada:novoEmprestimo.dataRetirada,horaRetirada:novoEmprestimo.horaRetirada,dataDevolucao:null,horaDevolucao:null,status:'emprestado',responsavel:'vinicius'};setEmprestimos(prev=>[...prev,emprestimo]);// Atualizar disponibilidade no invent치rio\natualizarInventario(novoEmprestimo.ferramentas,'remover');return emprestimo;};const devolverFerramentas=(id,atualizarInventario)=>{const emprestimo=emprestimos.find(e=>e.id===id);if(!emprestimo)return;const agora=new Date();setEmprestimos(prev=>prev.map(emp=>emp.id===id?_objectSpread(_objectSpread({},emp),{},{dataDevolucao:agora.toISOString().split('T')[0],horaDevolucao:agora.toTimeString().slice(0,5),status:'devolvido'}):emp));// Atualizar disponibilidade no invent치rio\natualizarInventario(emprestimo.ferramentas,'adicionar');};const removerEmprestimo=(id,atualizarInventario)=>{const emprestimo=emprestimos.find(e=>e.id===id);if(!emprestimo)return;// Se estava emprestado, devolver para o estoque\nif(emprestimo.status==='emprestado'){atualizarInventario(emprestimo.ferramentas,'adicionar');}setEmprestimos(prev=>prev.filter(emp=>emp.id!==id));};return{emprestimos,adicionarEmprestimo,devolverFerramentas,removerEmprestimo,setEmprestimos};};","map":{"version":3,"names":["useState","useEffect","historicoInicial","ref","set","onValue","db","encryptData","decryptData","useEmprestimos","emprestimos","setEmprestimos","emprestimosRef","snapshot","data","val","adicionarEmprestimo","novoEmprestimo","atualizarInventario","colaborador","ferramentas","length","lista","Array","isArray","novoId","Math","max","map","e","id","emprestimo","dataRetirada","horaRetirada","dataDevolucao","horaDevolucao","status","responsavel","prev","devolverFerramentas","find","agora","Date","emp","_objectSpread","toISOString","split","toTimeString","slice","removerEmprestimo","filter"],"sources":["C:/Users/vinic/OneDrive/Documentos/Almo/src/components/hooks/useEmprestimos.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { historicoInicial } from '../../data/historicoInicial';\r\nimport { ref, set, onValue } from 'firebase/database';\r\nimport { db } from '../../firebaseConfig';\r\nimport { encryptData, decryptData } from '../../services/encryptionService';\r\n\r\nexport const useEmprestimos = () => {\r\n  const [emprestimos, setEmprestimos] = useState([]);\r\n  \r\n  // Carregar dados ao inicializar\r\n  useEffect(() => {\r\n    const emprestimosRef = ref(db, 'emprestimos');\r\n    onValue(emprestimosRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        setEmprestimos(decryptData(data));\r\n      } else {\r\n        setEmprestimos(historicoInicial);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const adicionarEmprestimo = (novoEmprestimo, atualizarInventario) => {\r\n  if (!novoEmprestimo.colaborador || novoEmprestimo.ferramentas.length === 0) return;\r\n\r\n  const lista = Array.isArray(emprestimos) ? emprestimos : [];\r\n  const novoId = Math.max(...lista.map(e => e.id), 0) + 1;\r\n    const emprestimo = {\r\n      id: novoId,\r\n      colaborador: novoEmprestimo.colaborador,\r\n      ferramentas: [...novoEmprestimo.ferramentas],\r\n      dataRetirada: novoEmprestimo.dataRetirada,\r\n      horaRetirada: novoEmprestimo.horaRetirada,\r\n      dataDevolucao: null,\r\n      horaDevolucao: null,\r\n      status: 'emprestado',\r\n      responsavel: 'vinicius'\r\n    };\r\n\r\n    setEmprestimos(prev => [...prev, emprestimo]);\r\n    \r\n    // Atualizar disponibilidade no invent치rio\r\n    atualizarInventario(novoEmprestimo.ferramentas, 'remover');\r\n    \r\n    return emprestimo;\r\n  };\r\n\r\n  const devolverFerramentas = (id, atualizarInventario) => {\r\n    const emprestimo = emprestimos.find(e => e.id === id);\r\n    if (!emprestimo) return;\r\n    \r\n    const agora = new Date();\r\n    \r\n    setEmprestimos(prev => prev.map(emp => \r\n      emp.id === id \r\n        ? { \r\n            ...emp, \r\n            dataDevolucao: agora.toISOString().split('T')[0], \r\n            horaDevolucao: agora.toTimeString().slice(0, 5),\r\n            status: 'devolvido' \r\n          }\r\n        : emp\r\n    ));\r\n\r\n    // Atualizar disponibilidade no invent치rio\r\n    atualizarInventario(emprestimo.ferramentas, 'adicionar');\r\n  };\r\n\r\n  const removerEmprestimo = (id, atualizarInventario) => {\r\n    const emprestimo = emprestimos.find(e => e.id === id);\r\n    if (!emprestimo) return;\r\n    \r\n    // Se estava emprestado, devolver para o estoque\r\n    if (emprestimo.status === 'emprestado') {\r\n      atualizarInventario(emprestimo.ferramentas, 'adicionar');\r\n    }\r\n    \r\n    setEmprestimos(prev => prev.filter(emp => emp.id !== id));\r\n  };\r\n\r\n  return {\r\n    emprestimos,\r\n    adicionarEmprestimo,\r\n    devolverFerramentas,\r\n    removerEmprestimo,\r\n    setEmprestimos\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}