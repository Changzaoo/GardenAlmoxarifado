rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ⚠️ REGRAS DE TESTE - PERMISSIVAS
    // ⚠️ USAR APENAS PARA DESENVOLVIMENTO/TESTES
    // ⚠️ NÃO USAR EM PRODUÇÃO
    
    // Funções auxiliares básicas
    function isAuthenticated() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    // Regra padrão - PERMISSIVA PARA TESTES
    match /{document=**} {
      allow read, write: if isAuthenticated();
    }
    
    // Regras específicas para coleções principais
    
    // Usuários - qualquer usuário autenticado pode ler todos
    match /usuario/{userId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update: if isAuthenticated();
      allow delete: if isAuthenticated();
    }
    
    // Inventário - acesso total para usuários autenticados
    match /inventario/{itemId} {
      allow read, write: if isAuthenticated();
    }
    
    // Empréstimos - acesso total para usuários autenticados
    match /emprestimos/{emprestimoId} {
      allow read, write: if isAuthenticated();
    }
    
    // Verificações mensais - acesso total para usuários autenticados
    match /verificacoes_mensais/{verificacaoId} {
      allow read, write: if isAuthenticated();
    }
    
    // Ferramentas danificadas - acesso total para usuários autenticados
    match /ferramentas_danificadas/{ferramenta} {
      allow read, write: if isAuthenticated();
    }
    
    // Ferramentas perdidas - acesso total para usuários autenticados
    match /ferramentas_perdidas/{ferramenta} {
      allow read, write: if isAuthenticated();
    }
    
    // Histórico - acesso total para usuários autenticados
    match /historico/{historicoId} {
      allow read, write: if isAuthenticated();
    }
    
    // Analytics - acesso total para usuários autenticados
    match /analytics_acessos/{analiticaId} {
      allow read, write: if isAuthenticated();
    }
    
    // Backup test - acesso total para usuários autenticados
    match /backup_test/{backupId} {
      allow read, write: if isAuthenticated();
    }
    
    // Código de redefinição de senha - acesso total para facilitar testes
    match /codigo_redefinicao_senha/{codigoId} {
      allow read, write: if isAuthenticated();
    }
    
    // QR Codes de autenticação - leitura pública para validação, escrita para autenticados
    match /qr_codes_auth/{qrCodeId} {
      allow read: if true; // Qualquer um pode ler para validar QR Code
      allow create: if isAuthenticated();
      allow update: if isAuthenticated();
      allow delete: if isAuthenticated();
    }
    
    // Empresas - acesso total para usuários autenticados
    match /empresas/{empresaId} {
      allow read, write: if isAuthenticated();
    }
    
    // Setores - acesso total para usuários autenticados
    match /setores/{setorId} {
      allow read, write: if isAuthenticated();
    }
    
    // Mensagens - acesso total para usuários autenticados
    match /mensagens/{mensagemId} {
      allow read, write: if isAuthenticated();
    }
    
    // Tarefas - acesso total para usuários autenticados
    match /tarefas/{tarefaId} {
      allow read, write: if isAuthenticated();
    }
    
    // Templates - acesso total para usuários autenticados
    match /templates/{templateId} {
      allow read, write: if isAuthenticated();
    }
    
    // Pontos - acesso total para usuários autenticados
    match /pontos/{pontoId} {
      allow read, write: if isAuthenticated();
    }
    
    // Notificações - acesso total para usuários autenticados
    match /notificacoes/{notificacaoId} {
      allow read, write: if isAuthenticated();
    }
  }
}
