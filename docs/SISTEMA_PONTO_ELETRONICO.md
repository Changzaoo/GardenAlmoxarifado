# Sistema de Ponto Eletr√¥nico com Controle de Assiduidade

## üìã Resumo do Projeto

Sistema completo de controle de ponto eletr√¥nico com:
- ‚úÖ Toler√¢ncia de 10 minutos (antes/depois)
- ‚úÖ C√°lculo autom√°tico de horas trabalhadas
- ‚úÖ Sistema de advert√™ncias (m√°x 3)
- ‚úÖ Controle de assiduidade (pr√™mio R$ 100)
- ‚úÖ Comprovantes de ponto
- ‚úÖ Exporta√ß√£o para planilha

## ‚úÖ Arquivos Criados

### 1. `/src/utils/pontoUtils.js`
**Fun√ß√µes implementadas:**
- `validarTolerancia()` - Valida se ponto est√° dentro dos 10 minutos
- `podeBaterPonto()` - Verifica se pode bater ponto agora
- `calcularHorasTrabalhadas()` - Calcula horas do per√≠odo
- `calcularSaldoDia()` - Calcula saldo completo do dia
- `verificarAssiduidade()` - Verifica se mant√©m assiduidade
- `gerarResumoMensal()` - Gera resumo mensal completo

**Regras implementadas:**
- Toler√¢ncia: ¬±10 minutos
- Hora positiva: chegou antes (dentro da toler√¢ncia)
- Hora negativa: chegou depois (dentro da toler√¢ncia)
- Advert√™ncia: ultrapassou 10 minutos de atraso
- M√°ximo: 3 advert√™ncias = perde assiduidade
- Falta sem justificativa = perde assiduidade

### 2. `/src/utils/escalaUtils.js`
**Mapeamento de escalas:**
- `HORARIOS_POR_ESCALA` - Define hor√°rios para cada tipo de escala
  - M: 07:20-16:20 (semana), 07:20-13:20 (fim de semana)
  - M1: 07:00-15:20 (almo√ßo 12:00-13:00)
  - M4: 06:00-15:40 (almo√ßo 10:30-11:30, 5x2)

**Fun√ß√µes implementadas:**
- `obterHorariosEsperados()` - Retorna hor√°rios baseado na escala
- `obterEscalaDoDia()` - Obt√©m escala do funcion√°rio para o dia
- `deveTrabalharNoDia()` - Verifica se deve trabalhar
- `obterDescricaoJornada()` - Formata descri√ß√£o da jornada

## üîß Pr√≥ximas Implementa√ß√µes

### 1. Atualizar WorkPontoTab
**Arquivo:** `/src/components/WorkPontoTab.jsx`

**Altera√ß√µes necess√°rias:**
```jsx
// Adicionar imports
import { validarTolerancia, podeBaterPonto, calcularSaldoDia } from '../utils/pontoUtils';
import { obterHorariosEsperados, obterEscalaDoDia } from '../utils/escalaUtils';

// Adicionar estados
const [horariosEsperados, setHorariosEsperados] = useState(null);
const [saldoDia, setSaldoDia] = useState(null);
const [advertencias, setAdvertencias] = useState([]);

// Buscar escala do funcion√°rio
useEffect(() => {
  const buscarEscala = async () => {
    // Buscar tipo de escala do funcion√°rio no Firestore
    // Calcular hor√°rios esperados
    // Atualizar estado
  };
  buscarEscala();
}, [usuario]);

// Adicionar valida√ß√£o antes de bater ponto
const validarPonto = (tipo) => {
  const horario = horariosEsperados[tipo];
  const { podeBater, motivoBloqueio } = podeBaterPonto(horario);
  
  if (!podeBater) {
    showToast(motivoBloqueio, 'error');
    return false;
  }
  return true;
};

// Modificar fun√ß√£o baterPonto
const baterPonto = async (tipo) => {
  if (!validarPonto(tipo)) return;
  
  // ... c√≥digo existente ...
  
  // Ap√≥s bater ponto, calcular saldo
  const saldo = calcularSaldoDia(registros, horariosEsperados);
  setSaldoDia(saldo);
  
  // Se houver advert√™ncia, salvar no Firestore
  if (saldo.advertencias.length > 0) {
    await salvarAdvertencia(saldo.advertencias[saldo.advertencias.length - 1]);
  }
};
```

**Adicionar exibi√ß√£o de hor√°rios:**
```jsx
{/* Card de Hor√°rios Esperados */}
<div className="bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-950 dark:to-purple-950 rounded-xl p-4 mb-4">
  <h3 className="font-bold text-indigo-900 dark:text-indigo-100 mb-2">
    üìÖ Sua Jornada Hoje
  </h3>
  {horariosEsperados ? (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
      <div>
        <span className="text-xs text-gray-600 dark:text-gray-400">Entrada</span>
        <div className="font-bold">{horariosEsperados.entrada}</div>
      </div>
      <div>
        <span className="text-xs text-gray-600 dark:text-gray-400">Almo√ßo</span>
        <div className="font-bold">{horariosEsperados.almoco}</div>
      </div>
      <div>
        <span className="text-xs text-gray-600 dark:text-gray-400">Retorno</span>
        <div className="font-bold">{horariosEsperados.retorno}</div>
      </div>
      <div>
        <span className="text-xs text-gray-600 dark:text-gray-400">Sa√≠da</span>
        <div className="font-bold">{horariosEsperados.saida}</div>
      </div>
    </div>
  ) : (
    <p className="text-sm text-gray-600">Hor√°rio n√£o configurado</p>
  )}
</div>

{/* Card de Saldo do Dia */}
{saldoDia && (
  <div className="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950 dark:to-emerald-950 rounded-xl p-4 mb-4">
    <h3 className="font-bold text-green-900 dark:text-green-100 mb-2">
      ‚è±Ô∏è Saldo de Horas Hoje
    </h3>
    <div className="flex items-center justify-between">
      <div>
        <div className="text-2xl font-bold">
          {saldoDia.saldoFormatado}
        </div>
        <div className="text-sm text-gray-600">
          Trabalhado: {saldoDia.totalTrabalhado.formatado}
        </div>
      </div>
      {saldoDia.advertencias.length > 0 && (
        <div className="bg-red-100 dark:bg-red-900 px-3 py-2 rounded-lg">
          <span className="text-red-900 dark:text-red-100 font-bold">
            ‚ö†Ô∏è {saldoDia.advertencias.length} advert√™ncia(s)
          </span>
        </div>
      )}
    </div>
  </div>
)}
```

### 2. Criar Cards de Resumo na P√°gina de Funcion√°rios
**Arquivo:** Novo componente `/src/components/Funcionarios/ResumoAssiduidade.jsx`

```jsx
import React, { useEffect, useState } from 'react';
import { Clock, AlertTriangle, Trophy, Calendar } from 'lucide-react';
import { gerarResumoMensal, verificarAssiduidade } from '../../utils/pontoUtils';

const ResumoAssiduidade = ({ funcionarioId }) => {
  const [resumo, setResumo] = useState(null);
  
  useEffect(() => {
    // Buscar pontos do m√™s no Firestore
    // Calcular resumo com gerarResumoMensal()
  }, [funcionarioId]);
  
  if (!resumo) return null;
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      {/* Card Horas Trabalhadas */}
      <div className="bg-blue-50 dark:bg-blue-950 rounded-xl p-4">
        <div className="flex items-center gap-2 mb-2">
          <Clock className="w-5 h-5 text-blue-600" />
          <span className="text-sm font-semibold text-blue-900 dark:text-blue-100">
            Horas Trabalhadas
          </span>
        </div>
        <div className="text-2xl font-bold text-blue-900 dark:text-blue-100">
          {resumo.totalHorasTrabalhadas}
        </div>
        <div className="text-xs text-blue-700 dark:text-blue-300">
          {resumo.diasTrabalhados} dias no m√™s
        </div>
      </div>
      
      {/* Card Horas Extras */}
      <div className="bg-green-50 dark:bg-green-950 rounded-xl p-4">
        <div className="flex items-center gap-2 mb-2">
          <Calendar className="w-5 h-5 text-green-600" />
          <span className="text-sm font-semibold text-green-900 dark:text-green-100">
            Horas Extras
          </span>
        </div>
        <div className="text-2xl font-bold text-green-900 dark:text-green-100">
          {resumo.totalHorasExtras}
        </div>
      </div>
      
      {/* Card Advert√™ncias */}
      <div className="bg-red-50 dark:bg-red-950 rounded-xl p-4">
        <div className="flex items-center gap-2 mb-2">
          <AlertTriangle className="w-5 h-5 text-red-600" />
          <span className="text-sm font-semibold text-red-900 dark:text-red-100">
            Advert√™ncias
          </span>
        </div>
        <div className="text-2xl font-bold text-red-900 dark:text-red-100">
          {resumo.totalAdvertencias} / 3
        </div>
        <div className="text-xs text-red-700 dark:text-red-300">
          Faltas: {resumo.totalFaltas}
        </div>
      </div>
      
      {/* Card Assiduidade */}
      <div className={`rounded-xl p-4 ${
        resumo.assiduidade.temAssiduidade 
          ? 'bg-yellow-50 dark:bg-yellow-950' 
          : 'bg-gray-50 dark:bg-gray-800'
      }`}>
        <div className="flex items-center gap-2 mb-2">
          <Trophy className={`w-5 h-5 ${
            resumo.assiduidade.temAssiduidade ? 'text-yellow-600' : 'text-gray-600'
          }`} />
          <span className="text-sm font-semibold">
            Assiduidade
          </span>
        </div>
        <div className="text-2xl font-bold">
          {resumo.assiduidade.temAssiduidade ? '‚úÖ' : '‚ùå'}
        </div>
        <div className="text-xs">
          {resumo.assiduidade.temAssiduidade 
            ? `Pr√™mio: R$ ${resumo.assiduidade.premioValor},00`
            : 'Pr√™mio perdido'}
        </div>
      </div>
    </div>
  );
};

export default ResumoAssiduidade;
```

### 3. Criar Comprovante de Ponto
**Arquivo:** `/src/components/Comprovantes/ComprovantePontoVisual.jsx`

Seguir o mesmo padr√£o do `ComprovanteVisual.jsx`:
- Logo WorkFlow no topo
- Dados do funcion√°rio
- Hor√°rios batidos vs esperados
- Saldo de horas
- Advert√™ncias (se houver)
- Assinatura digital √∫nica
- Bot√µes de download PDF e compartilhar

### 4. Exporta√ß√£o para Planilha
**Arquivo:** `/src/utils/exportarPontos.js`

```javascript
import * as XLSX from 'xlsx';

export const exportarPontosParaExcel = (pontos, funcionario, formato = 'xlsx') => {
  // Preparar dados
  const dados = pontos.map(ponto => ({
    Data: formatarData(ponto.data),
    Entrada: formatarHora(ponto.entrada),
    Almo√ßo: formatarHora(ponto.almoco),
    Retorno: formatarHora(ponto.retorno),
    Sa√≠da: formatarHora(ponto.saida),
    'Horas Trab.': ponto.horasTrabalhadas,
    Saldo: ponto.saldo,
    Obs: ponto.observacao || ''
  }));
  
  // Criar workbook
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(dados);
  
  // Adicionar logo e t√≠tulo (merge cells)
  // ...
  
  XLSX.utils.book_append_sheet(wb, ws, 'Pontos');
  XLSX.writeFile(wb, `Pontos_${funcionario.nome}_${new Date().toISOString().split('T')[0]}.${formato}`);
};
```

## üîÑ Fluxo de Uso

1. **Funcion√°rio entra na aba WorkPonto**
   - Sistema busca sua escala no Firestore
   - Exibe hor√°rios esperados do dia
   - Mostra janela de toler√¢ncia (¬±10 min)

2. **Funcion√°rio tenta bater ponto**
   - Sistema valida se est√° dentro da janela
   - Se n√£o, bloqueia e exibe mensagem
   - Se sim, registra e calcula diferen√ßa

3. **Ap√≥s cada ponto**
   - Calcula saldo parcial do dia
   - Se atraso > 10min, gera advert√™ncia
   - Atualiza contador de advert√™ncias

4. **Final do dia**
   - Calcula total de horas trabalhadas
   - Calcula horas extras
   - Atualiza saldo mensal

5. **Final do m√™s**
   - Verifica total de advert√™ncias
   - Verifica faltas n√£o justificadas
   - Define se mant√©m assiduidade (pr√™mio R$ 100)

## üìä Estrutura de Dados no Firestore

### Collection: `pontos`
```javascript
{
  funcionarioId: string,
  funcionarioNome: string,
  tipo: 'entrada' | 'saida_almoco' | 'retorno_almoco' | 'saida',
  data: timestamp,
  horarioEsperado: string, // "HH:mm"
  diferencaMinutos: number, // positivo = atrasado, negativo = adiantado
  dentroTolerancia: boolean,
  tipoRegistro: 'pontual' | 'hora_positiva' | 'hora_negativa' | 'atrasado',
  observacao: string
}
```

### Collection: `advertencias`
```javascript
{
  funcionarioId: string,
  data: timestamp,
  tipoPonto: string,
  minutosAtraso: number,
  justificativa: string,
  comprovante: string (URL),
  resolvida: boolean
}
```

### Collection: `assiduidade_mensal`
```javascript
{
  funcionarioId: string,
  mes: string, // "2025-10"
  diasTrabalhados: number,
  totalHoras: number,
  totalHorasExtras: number,
  totalAdvertencias: number,
  totalFaltas: number,
  temAssiduidade: boolean,
  premioValor: number
}
```

## ‚ö†Ô∏è Advert√™ncias e Regras

### Gera√ß√£o de Advert√™ncia
- Atraso > 10 minutos em qualquer ponto
- Registrado automaticamente no Firestore
- Notifica√ß√£o enviada ao funcion√°rio
- Supervisor recebe alerta

### 3¬™ Advert√™ncia
- Modal de alerta ao funcion√°rio
- Perde direito √† assiduidade do m√™s
- Perde pr√™mio de R$ 100
- Precisa apresentar justificativa

### Justificativa de Atraso
- Upload de comprovante (foto/PDF)
- Aprova√ß√£o por supervisor
- Se aprovada, advert√™ncia √© cancelada

### Falta N√£o Justificada
- Aus√™ncia sem registro de ponto
- Sem atestado = perde assiduidade
- Com atestado = mant√©m assiduidade

## üéØ Melhorias Futuras

1. **Notifica√ß√µes Push**
   - Lembrete 15min antes do hor√°rio
   - Alerta de advert√™ncia
   - Confirma√ß√£o de assiduidade

2. **Relat√≥rios Avan√ßados**
   - Gr√°ficos de pontualidade
   - Comparativo mensal
   - Ranking de assiduidade

3. **Integra√ß√£o com RH**
   - Exporta√ß√£o para folha de pagamento
   - C√°lculo autom√°tico de horas extras
   - Relat√≥rio de assiduidade para b√¥nus

4. **Ponto por Geolocaliza√ß√£o**
   - Validar se est√° no local de trabalho
   - Ponto remoto controlado
   - Mapa de check-ins

5. **Reconhecimento Facial**
   - Valida√ß√£o biom√©trica
   - Preven√ß√£o de fraudes
   - Maior seguran√ßa
