# üóëÔ∏è Exclus√£o de Usu√°rios por N√≠vel de Permiss√£o

## üìã Vis√£o Geral

Foi implementada uma funcionalidade avan√ßada de exclus√£o de usu√°rios que permite remover m√∫ltiplos usu√°rios de uma vez, seja por sele√ß√£o manual ou por n√≠vel de permiss√£o (cargo).

## ‚ú® Funcionalidades

### üéØ Dois Modos de Exclus√£o

#### 1. **Usu√°rios Selecionados** (Modo Padr√£o)
- Excluir usu√°rios manualmente selecionados na lista
- Permite escolher especificamente quais usu√°rios remover
- Ideal para exclus√µes pontuais

#### 2. **Por N√≠vel de Permiss√£o** (Novo)
- Excluir TODOS os usu√°rios de um determinado n√≠vel/cargo
- Sele√ß√£o por dropdown com contador de usu√°rios
- Preview em tempo real dos usu√°rios que ser√£o exclu√≠dos
- Ideal para limpeza em massa

## üîß Como Usar

### Acesso ao Modo Exclus√£o por N√≠vel

1. **Navegar para**: Usu√°rios > Sistema
2. **Clicar em**: Bot√£o "Excluir Selecionados" (vermelho)
3. **Selecionar**: Modo "Por N√≠vel de Permiss√£o"

### Passo a Passo - Exclus√£o por N√≠vel

```
1. Abrir modal de exclus√£o
   ‚îî‚îÄ Clicar no bot√£o "Excluir Selecionados"

2. Escolher modo de exclus√£o
   ‚îî‚îÄ Clicar no card "Por N√≠vel de Permiss√£o"

3. Selecionar n√≠vel de permiss√£o
   ‚îî‚îÄ Escolher no dropdown (mostra contador)
   ‚îî‚îÄ Exemplo: "Funcion√°rio (37 usu√°rios)"

4. Revisar usu√°rios que ser√£o exclu√≠dos
   ‚îî‚îÄ Lista com preview (primeiros 10)
   ‚îî‚îÄ Contador total na lista

5. Confirmar exclus√£o
   ‚îî‚îÄ Clicar em "Excluir X Usu√°rio(s)"
```

### Passo a Passo - Exclus√£o por Sele√ß√£o

```
1. Ativar modo sele√ß√£o
   ‚îî‚îÄ Clicar em "Ativar Sele√ß√£o M√∫ltipla"

2. Selecionar usu√°rios manualmente
   ‚îî‚îÄ Clicar nas checkboxes dos usu√°rios
   ‚îî‚îÄ Ou usar "Selecionar Todos"

3. Abrir modal de exclus√£o
   ‚îî‚îÄ Clicar em "Excluir Selecionados"

4. Modo j√° est√° em "Usu√°rios Selecionados"
   ‚îî‚îÄ Revisar lista

5. Confirmar exclus√£o
   ‚îî‚îÄ Clicar em "Excluir X Selecionado(s)"
```

## üé® Interface

### Cards de Sele√ß√£o de Modo

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üë§ Usu√°rios            ‚îÇ  üõ°Ô∏è Por N√≠vel de       ‚îÇ
‚îÇ     Selecionados        ‚îÇ     Permiss√£o          ‚îÇ
‚îÇ                         ‚îÇ                         ‚îÇ
‚îÇ  5 selecionado(s)       ‚îÇ  Excluir por cargo     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Dropdown de N√≠veis

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Selecione um n√≠vel                    ‚ñº ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Administrador (37 usu√°rios)             ‚îÇ
‚îÇ Gerente Geral (5 usu√°rios)              ‚îÇ
‚îÇ Gerente de Setor (12 usu√°rios)          ‚îÇ
‚îÇ Supervisor (8 usu√°rios)                 ‚îÇ
‚îÇ Funcion√°rio (37 usu√°rios)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Preview de Usu√°rios

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Usu√°rios que ser√£o exclu√≠dos (37):                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ ‚îÇ [A] Admin 1          [Funcion√°rio]       ‚îÇ        ‚îÇ
‚îÇ ‚îÇ     admin1                               ‚îÇ        ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ ‚îÇ [A] Admin 2          [Funcion√°rio]       ‚îÇ        ‚îÇ
‚îÇ ‚îÇ     admin2                               ‚îÇ        ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ ...                                                  ‚îÇ
‚îÇ +27 mais...                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## ‚ö†Ô∏è Avisos de Seguran√ßa

### Valida√ß√µes Implementadas

1. **Verifica√ß√£o de Permiss√µes**
   - Respeita hierarquia de permiss√µes
   - Usu√°rio s√≥ pode excluir n√≠veis inferiores

2. **Preview Obrigat√≥rio**
   - Sempre mostra quem ser√° exclu√≠do
   - Contador em tempo real

3. **Confirma√ß√£o Expl√≠cita**
   - Aviso vermelho de a√ß√£o irrevers√≠vel
   - Bot√£o desabilitado at√© sele√ß√£o v√°lida

4. **Mensagens Claras**
   ```
   ‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o √© irrevers√≠vel!
   Todos os usu√°rios com o n√≠vel de permiss√£o 
   selecionado ser√£o exclu√≠dos permanentemente.
   ```

## üîí Casos de Uso

### 1. Limpar Admins Duplicados Criados Incorretamente
```javascript
// Cen√°rio: Rota√ß√£o criou m√∫ltiplos admins com n√≠vel funcion√°rio
Modo: Por N√≠vel de Permiss√£o
N√≠vel: Funcion√°rio
Resultado: Remove todos os funcion√°rios de uma vez
```

### 2. Remover Usu√°rios de Teste
```javascript
// Cen√°rio: Ap√≥s testes, remover contas tempor√°rias
Modo: Usu√°rios Selecionados
Sele√ß√£o: Marcar manualmente os usu√°rios de teste
Resultado: Remove apenas os selecionados
```

### 3. Reestrutura√ß√£o de Hierarquia
```javascript
// Cen√°rio: Mudar estrutura organizacional
Modo: Por N√≠vel de Permiss√£o
N√≠vel: Supervisor
Resultado: Remove todos os supervisores para recriar
```

## üìä Estat√≠sticas e Feedback

### Mensagens de Sucesso
```
‚úÖ 37 usu√°rio(s) processado(s) com sucesso!
```

### Mensagens de Erro
```
‚ùå 5 usu√°rio(s) n√£o puderam ser processados
```

### Informa√ß√µes no Console
```javascript
console.log(`Excluindo usu√°rio ${usuarioId}...`);
// Para cada usu√°rio processado
```

## üõ°Ô∏è Prote√ß√µes Implementadas

### 1. N√£o Permite Excluir Pr√≥prio Usu√°rio
```javascript
if (usuarioLogado.id === usuarioId) {
  erros++;
  continue;
}
```

### 2. Valida√ß√£o de Hierarquia
```javascript
if (!PermissionChecker.canEditUser(
  usuarioLogado.nivel, 
  usuarioLogado.id, 
  usuarioId, 
  usuario.nivel
)) {
  erros++;
  continue;
}
```

### 3. Tratamento de Erros Individual
```javascript
try {
  await removerUsuario(usuarioId);
  sucessos++;
} catch (error) {
  console.error(`Erro ao processar ${usuarioId}:`, error);
  erros++;
}
```

## üìù C√≥digo Principal

### Estado do Formul√°rio
```javascript
const [formAcaoLote, setFormAcaoLote] = useState({
  empresaId: '',
  setorId: '',
  nivelPermissao: '',
  modoExclusao: 'selecionados' // 'selecionados' ou 'porNivel'
});
```

### L√≥gica de Exclus√£o
```javascript
// Determinar quais usu√°rios processar
if (formAcaoLote.modoExclusao === 'porNivel') {
  // Excluir por n√≠vel de permiss√£o
  usuariosParaProcessar = usuarios.filter(
    u => u.nivel === parseInt(formAcaoLote.nivelPermissao)
  );
} else {
  // Usar usu√°rios selecionados
  usuariosParaProcessar = usuariosSelecionados
    .map(id => usuarios.find(u => u.id === id))
    .filter(Boolean);
}
```

### Contador Din√¢mico
```javascript
{Object.entries(NIVEIS_LABELS).map(([nivel, label]) => {
  const count = usuarios.filter(
    u => u.nivel === parseInt(nivel)
  ).length;
  return (
    <option key={nivel} value={nivel}>
      {label} ({count} usu√°rio{count !== 1 ? 's' : ''})
    </option>
  );
})}
```

## üéØ N√≠veis de Permiss√£o

### Hierarquia Completa

| N√≠vel | C√≥digo | Permiss√£o              |
|-------|--------|------------------------|
| 0     | ADMIN  | Administrador          |
| 1     | GG     | Gerente Geral          |
| 2     | GS     | Gerente de Setor       |
| 3     | SUP    | Supervisor             |
| 4     | FUNC   | Funcion√°rio            |

## üîÑ Fluxo de Dados

```mermaid
graph TD
    A[Clicar Excluir] --> B{Tem Selecionados?}
    B -->|Sim| C[Modo: Selecionados]
    B -->|N√£o| D[Modo: Por N√≠vel]
    C --> E[Abrir Modal]
    D --> E
    E --> F{Usu√°rio Escolhe}
    F -->|Selecionados| G[Lista Sele√ß√µes]
    F -->|Por N√≠vel| H[Dropdown N√≠veis]
    H --> I[Preview Usu√°rios]
    G --> J[Confirmar]
    I --> J
    J --> K[executarAcaoLote]
    K --> L{Para cada usu√°rio}
    L --> M[Verificar Permiss√µes]
    M --> N[removerUsuario]
    N --> O{Sucesso?}
    O -->|Sim| P[Incrementar sucessos]
    O -->|N√£o| Q[Incrementar erros]
    P --> R[Pr√≥ximo]
    Q --> R
    R --> L
    R --> S[Mostrar Resumo]
```

## üöÄ Melhorias Futuras

### Poss√≠veis Aprimoramentos

1. **Exportar Lista Antes de Excluir**
   - Gerar CSV com usu√°rios que ser√£o exclu√≠dos
   - Backup autom√°tico

2. **Exclus√£o Suave (Soft Delete)**
   - Marcar como inativo ao inv√©s de excluir
   - Possibilidade de restaura√ß√£o

3. **Agendamento de Exclus√£o**
   - Agendar exclus√£o para data/hora espec√≠fica
   - Notifica√ß√µes aos usu√°rios afetados

4. **Filtros Avan√ßados**
   - Excluir por empresa + n√≠vel
   - Excluir por data de cria√ß√£o
   - Excluir inativos h√° X dias

5. **Auditoria Detalhada**
   - Log de quem excluiu
   - Quando excluiu
   - Quantos excluiu
   - N√≠vel dos exclu√≠dos

## üìö Arquivos Relacionados

- `src/components/usuarios/UsuariosTab.jsx` - Componente principal
- `src/constants/permissoes.js` - Defini√ß√µes de n√≠veis
- `src/hooks/useAuth.js` - Hook de autentica√ß√£o
- `docs/FIX_ADMIN_DUPLICADO_ROTACAO.md` - Contexto do problema

## üéì Boas Pr√°ticas

### Recomenda√ß√µes de Uso

1. ‚úÖ **Sempre revisar** a lista de preview antes de confirmar
2. ‚úÖ **Fazer backup** antes de exclus√µes em massa
3. ‚úÖ **Testar primeiro** em ambiente de desenvolvimento
4. ‚úÖ **Documentar** motivo da exclus√£o em massa
5. ‚ùå **Nunca excluir** sem verificar o impacto

### Quando Usar Cada Modo

**Use "Usu√°rios Selecionados":**
- Exclus√µes pontuais
- Casos espec√≠ficos
- Menos de 10 usu√°rios

**Use "Por N√≠vel de Permiss√£o":**
- Limpeza em massa
- Reestrutura√ß√£o organizacional
- Remover todos de um cargo

## ‚ö° Performance

### Otimiza√ß√µes Implementadas

1. **Processamento Ass√≠ncrono**
   ```javascript
   for (const usuario of usuariosParaProcessar) {
     await removerUsuario(usuario.id);
   }
   ```

2. **Preview Limitado**
   ```javascript
   .slice(0, 10) // Mostra apenas 10 primeiros
   ```

3. **Contador Eficiente**
   ```javascript
   usuarios.filter(u => u.nivel === parseInt(nivel)).length
   ```

## üêõ Troubleshooting

### Problemas Comuns

1. **Bot√£o desabilitado**
   - ‚úì Verifique se selecionou um n√≠vel v√°lido
   - ‚úì Verifique se h√° usu√°rios no n√≠vel escolhido

2. **Erro ao excluir**
   - ‚úì Verifique suas permiss√µes
   - ‚úì N√£o pode excluir n√≠veis superiores ou iguais

3. **Usu√°rios n√£o aparecem**
   - ‚úì Verifique se existem usu√°rios naquele n√≠vel
   - ‚úì Recarregue a lista de usu√°rios

## üìû Suporte

Se encontrar problemas ou tiver sugest√µes:
1. Verifique este documento primeiro
2. Consulte os logs do console
3. Reporte bugs com detalhes do erro

---

**Documenta√ß√£o criada em**: 13 de outubro de 2025  
**Vers√£o**: 1.0  
**Autor**: Sistema de Gerenciamento WorkFlow
